name: è‡ªåŠ¨åŒæ­¥ä¸Šæ¸¸åˆ†æ”¯

on:
  schedule:
    # æ¯åˆ†é’Ÿæ£€æŸ¥
    - cron: '* * * * *'
  workflow_dispatch:
    # å…è®¸æ‰‹åŠ¨è§¦å‘
    inputs:
      force_sync:
        description: 'å¼ºåˆ¶åŒæ­¥ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰'
        required: false
        default: 'false'
        type: boolean

env:
  # åŒæ­¥çš„åˆ†æ”¯ - mainã€v1.0.0-preview
  SYNC_BRANCH : main

jobs:
  check-upstream:
    runs-on: ubuntu-latest
    name: æ£€æŸ¥ä¸Šæ¸¸æ›´æ–°
    outputs:
      has_updates: ${{ steps.check_updates.outputs.has_updates }}
      has_conflicts: ${{ steps.check_updates.outputs.has_conflicts }}
      new_commits: ${{ steps.check_updates.outputs.new_commits }}
      recent_commits: ${{ steps.check_updates.outputs.recent_commits }}
      priority: ${{ steps.analyze_updates.outputs.priority }}
      reason: ${{ steps.analyze_updates.outputs.reason }}
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install requests
    
    - name: é…ç½®Git
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
    
    - name: æ·»åŠ ä¸Šæ¸¸ä»“åº“
      run: |
        git remote add upstream https://github.com/hsliuping/TradingAgents-CN.git || true
        git fetch upstream
        git checkout ${{ env.SYNC_BRANCH }}        
    
    - name: æ£€æŸ¥ä¸Šæ¸¸æ›´æ–°
      id: check_updates
      run: |
        # è·å–ä¸Šæ¸¸æ–°æäº¤æ•°é‡
        NEW_COMMITS=$(git rev-list --count HEAD..upstream/${{ env.SYNC_BRANCH }})
        echo "new_commits=$NEW_COMMITS" >> $GITHUB_OUTPUT
        
        if [ "$NEW_COMMITS" -gt 0 ]; then
          echo "has_updates=true" >> $GITHUB_OUTPUT
          echo "å‘ç° $NEW_COMMITS ä¸ªæ–°æäº¤"
          
          # è·å–æœ€æ–°æäº¤ä¿¡æ¯
          git log --oneline --no-merges HEAD..upstream/${{ env.SYNC_BRANCH }} | head -10 > recent_commits.txt
          echo "recent_commits<<EOF" >> $GITHUB_OUTPUT
          cat recent_commits.txt >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          # æ£€æŸ¥æ˜¯å¦æœ‰å†²çªé£é™©
          git merge-tree `git merge-base HEAD upstream/${{ env.SYNC_BRANCH }}` HEAD upstream/${{ env.SYNC_BRANCH }} > merge_result.txt 2>&1 || true
          if grep -q "changed in both" merge_result.txt; then
            echo "has_conflicts=true" >> $GITHUB_OUTPUT
            echo "æ£€æµ‹åˆ°å¯èƒ½çš„æ–‡ä»¶å†²çª"
          else
            echo "has_conflicts=false" >> $GITHUB_OUTPUT
            echo "æ— å†²çªé£é™©"
          fi
        else
          echo "has_updates=false" >> $GITHUB_OUTPUT
          echo "has_conflicts=false" >> $GITHUB_OUTPUT
          echo "æ²¡æœ‰æ–°çš„ä¸Šæ¸¸æ›´æ–°"
        fi
    
    - name: åˆ†ææ›´æ–°ç±»å‹
      if: steps.check_updates.outputs.has_updates == 'true'
      id: analyze_updates
      run: |
        # åˆ†ææäº¤ç±»å‹
        FEATURES=$(git log --oneline --no-merges HEAD..upstream/${{ env.SYNC_BRANCH }} | grep -i -E "(feat|feature|add)" | wc -l)
        FIXES=$(git log --oneline --no-merges HEAD..upstream/${{ env.SYNC_BRANCH }} | grep -i -E "(fix|bug|patch)" | wc -l)
        DOCS=$(git log --oneline --no-merges HEAD..upstream/${{ env.SYNC_BRANCH }} | grep -i -E "(doc|readme)" | wc -l)
        
        echo "features=$FEATURES" >> $GITHUB_OUTPUT
        echo "fixes=$FIXES" >> $GITHUB_OUTPUT
        echo "docs=$DOCS" >> $GITHUB_OUTPUT
        
        # åˆ¤æ–­æ›´æ–°ä¼˜å…ˆçº§
        if [ "$FIXES" -gt 0 ]; then
          echo "priority=high" >> $GITHUB_OUTPUT
          echo "reason=åŒ…å«Bugä¿®å¤" >> $GITHUB_OUTPUT
        elif [ "$FEATURES" -gt 2 ]; then
          echo "priority=medium" >> $GITHUB_OUTPUT
          echo "reason=åŒ…å«å¤šä¸ªæ–°åŠŸèƒ½" >> $GITHUB_OUTPUT
        else
          echo "priority=low" >> $GITHUB_OUTPUT
          echo "reason=å¸¸è§„æ›´æ–°" >> $GITHUB_OUTPUT
        fi
    
    - name: è¾“å‡ºæ›´æ–°æŠ¥å‘Š
      if: steps.check_updates.outputs.has_updates == 'true'
      run: |
        echo "ğŸ“Š æ›´æ–°æŠ¥å‘Š"
        echo "æ–°æäº¤æ•°é‡: ${{ steps.check_updates.outputs.new_commits }}"
        echo "æ›´æ–°ä¼˜å…ˆçº§: ${{ steps.analyze_updates.outputs.priority }}"
        echo "ä¼˜å…ˆçº§åŸå› : ${{ steps.analyze_updates.outputs.reason }}"
        echo "å†²çªçŠ¶æ€: ${{ steps.check_updates.outputs.has_conflicts }}"
        echo ""
        echo "æœ€è¿‘æäº¤:"
        echo "${{ steps.check_updates.outputs.recent_commits }}"
    
    # - name: åˆ›å»ºIssueæŠ¥å‘Š
    #   if: steps.check_updates.outputs.has_updates == 'true'
    #   uses: actions/github-script@v7
    #   with:
    #     script: |
    #       const newCommits = '${{ steps.check_updates.outputs.new_commits }}';
    #       const recentCommits = `${{ steps.check_updates.outputs.recent_commits }}`;
    #       const features = '${{ steps.analyze_updates.outputs.features }}';
    #       const fixes = '${{ steps.analyze_updates.outputs.fixes }}';
    #       const docs = '${{ steps.analyze_updates.outputs.docs }}';
    #       const priority = '${{ steps.analyze_updates.outputs.priority }}';
    #       const reason = '${{ steps.analyze_updates.outputs.reason }}';
    #       const hasConflicts = '${{ steps.check_updates.outputs.has_conflicts }}' === 'true';
          
    #       const issueTitle = `ğŸ”„ ä¸Šæ¸¸æ›´æ–°æ£€æµ‹ - ${newCommits} ä¸ªæ–°æäº¤${hasConflicts ? ' âš ï¸æœ‰å†²çªé£é™©' : ''}`;
    #       const issueBody = `
    #       ## ğŸ“Š æ›´æ–°æ¦‚è§ˆ
          
    #       - **æ–°æäº¤æ•°é‡**: ${newCommits}
    #       - **æ›´æ–°ä¼˜å…ˆçº§**: ${priority.toUpperCase()}
    #       - **ä¼˜å…ˆçº§åŸå› **: ${reason}
    #       - **å†²çªçŠ¶æ€**: ${hasConflicts ? 'âš ï¸ æ£€æµ‹åˆ°å¯èƒ½çš„å†²çª' : 'âœ… æ— å†²çª'}
          
    #       ## ğŸ“ˆ æ›´æ–°åˆ†æ
          
    #       - ğŸ†• æ–°åŠŸèƒ½: ${features} ä¸ª
    #       - ğŸ› Bugä¿®å¤: ${fixes} ä¸ª  
    #       - ğŸ“š æ–‡æ¡£æ›´æ–°: ${docs} ä¸ª
          
    #       ## ğŸ“‹ æœ€è¿‘æäº¤
          
    #       \`\`\`
    #       ${recentCommits}
    #       \`\`\`
          
    #       ## ğŸ¯ å»ºè®®è¡ŒåŠ¨
          
    #       ${hasConflicts ? 
    #         'âš ï¸ **æ£€æµ‹åˆ°å¯èƒ½çš„å†²çªï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†**' :
    #         priority === 'high' ? 
    #         'âš ï¸ **å»ºè®®ç«‹å³åŒæ­¥** - åŒ…å«é‡è¦çš„Bugä¿®å¤' : 
    #         priority === 'medium' ? 
    #         'ğŸ“… **å»ºè®®æœ¬å‘¨å†…åŒæ­¥** - åŒ…å«æœ‰ä»·å€¼çš„æ–°åŠŸèƒ½' : 
    #         'ğŸ“ **å¯ä»¥è®¡åˆ’åŒæ­¥** - å¸¸è§„æ›´æ–°ï¼Œå¯ä»¥å®‰æ’æ—¶é—´åŒæ­¥'
    #       }
          
    #       ## ğŸ”§ åŒæ­¥é€‰é¡¹
          
    #       1. **è‡ªåŠ¨åŒæ­¥** (ä»…é™æ— å†²çªæƒ…å†µ): é‡æ–°è¿è¡Œæ­¤ workflow å¹¶é€‰æ‹©"å¼ºåˆ¶åŒæ­¥"
    #       2. **æ‰‹åŠ¨åŒæ­¥**: ä½¿ç”¨ git å‘½ä»¤æ‰‹åŠ¨åˆå¹¶
    #       3. **ä½¿ç”¨ PR**: åˆ›å»ºåŒæ­¥åˆ†æ”¯å¹¶å¤„ç†å†²çª
          
    #       ## ğŸ“ ç›¸å…³é“¾æ¥
          
    #       - [ä¸Šæ¸¸ä»“åº“](https://github.com/hsliuping/TradingAgents-CN)
    #       - [åŒæ­¥ç­–ç•¥æ–‡æ¡£](docs/maintenance/upstream-sync.md)
          
    #       ---
          
    #       *æ­¤Issueç”±GitHub Actionsè‡ªåŠ¨åˆ›å»ºäº ${new Date().toISOString()}*
    #       `;
          
    #       // æ£€æŸ¥æ˜¯å¦å·²æœ‰ç›¸ä¼¼çš„Issue
    #       const existingIssues = await github.rest.issues.listForRepo({
    #         owner: context.repo.owner,
    #         repo: context.repo.repo,
    #         state: 'open',
    #         labels: 'upstream-sync'
    #       });
          
    #       const hasOpenSyncIssue = existingIssues.data.some(issue => 
    #         issue.title.includes('ä¸Šæ¸¸æ›´æ–°æ£€æµ‹')
    #       );
          
    #       if (!hasOpenSyncIssue) {
    #         await github.rest.issues.create({
    #           owner: context.repo.owner,
    #           repo: context.repo.repo,
    #           title: issueTitle,
    #           body: issueBody,
    #           labels: ['upstream-sync', priority === 'high' ? 'priority-high' : priority === 'medium' ? 'priority-medium' : 'priority-low', hasConflicts ? 'conflict' : 'no-conflict']
    #         });
            
    #         console.log('âœ… å·²åˆ›å»ºä¸Šæ¸¸æ›´æ–°Issue');
    #       } else {
    #         console.log('â„¹ï¸ å·²å­˜åœ¨å¼€æ”¾çš„åŒæ­¥Issueï¼Œè·³è¿‡åˆ›å»º');
    #       }

  auto-sync:
    runs-on: ubuntu-latest
    name: è‡ªåŠ¨åŒæ­¥ï¼ˆæ— å†²çªæ—¶è‡ªåŠ¨åˆå¹¶ï¼‰
    needs: check-upstream
    # ä¿®æ­£æ¡ä»¶ï¼šåªè¦æœ‰æ›´æ–°ä¸”ï¼ˆå¼ºåˆ¶åŒæ­¥æˆ–æ²¡æœ‰å†²çªï¼‰å°±æ‰§è¡Œ
    if: |
      (needs.check-upstream.outputs.has_updates == 'true') &&
      (github.event.inputs.force_sync == 'true' || needs.check-upstream.outputs.has_conflicts == 'false')
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: é…ç½®Git
      run: |
        git config --global user.name 'GitHub Actions Bot'
        git config --global user.email 'actions@github.com'
    
    - name: æ·»åŠ ä¸Šæ¸¸ä»“åº“å¹¶åˆå¹¶
      id: merge_upstream
      run: |
        git remote add upstream https://github.com/hsliuping/TradingAgents-CN.git
        git fetch upstream
        
        # åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯
        git checkout ${{ env.SYNC_BRANCH }}
        
        echo "å¼€å§‹åˆå¹¶ä¸Šæ¸¸æ›´æ–°..."
        echo "å½“å‰åˆ†æ”¯: $(git branch --show-current)"
        echo "ä¸Šæ¸¸åˆ†æ”¯: upstream/${{ env.SYNC_BRANCH }}"
        echo "æ–°æäº¤æ•°é‡: ${{ needs.check-upstream.outputs.new_commits }}"
        
        # å°è¯•åˆå¹¶ï¼Œä½¿ç”¨ --no-ff ç¡®ä¿åˆ›å»ºåˆå¹¶æäº¤
        if git merge upstream/${{ env.SYNC_BRANCH }} --no-ff --no-edit -m "è‡ªåŠ¨åˆå¹¶ä¸Šæ¸¸æ›´æ–° $(date +'%Y-%m-%d %H:%M:%S')"; then
          echo "âœ… åˆå¹¶æˆåŠŸ"
          echo "merge_success=true" >> $GITHUB_OUTPUT
        else
          echo "âŒ åˆå¹¶å¤±è´¥ï¼Œå­˜åœ¨å†²çª"
          echo "merge_success=false" >> $GITHUB_OUTPUT
          
          # æ˜¾ç¤ºå†²çªæ–‡ä»¶
          echo "å†²çªçŠ¶æ€:"
          git status
          exit 1
        fi
    
    - name: æ¨é€æ›´æ–°
      if: steps.merge_upstream.outputs.merge_success == 'true'
      run: |
        echo "æ¨é€æ›´æ–°åˆ°è¿œç¨‹ä»“åº“..."
        git push origin ${{ env.SYNC_BRANCH }}
        echo "âœ… æ›´æ–°å·²æ¨é€"
    
    - name: è¾“å‡ºåŒæ­¥æˆåŠŸæŠ¥å‘Š
      if: steps.merge_upstream.outputs.merge_success == 'true'
      run: |
        echo "âœ… è‡ªåŠ¨åŒæ­¥å®Œæˆ"
        echo "åŒæ­¥æ—¶é—´: $(date)"
        echo "åŒæ­¥æäº¤: ${{ needs.check-upstream.outputs.new_commits }} ä¸ªæ–°æäº¤"
        echo "æ›´æ–°ä¼˜å…ˆçº§: ${{ needs.check-upstream.outputs.priority }}"
        echo "è§¦å‘æ–¹å¼: ${{ github.event_name == 'workflow_dispatch' && 'æ‰‹åŠ¨è§¦å‘' || 'è‡ªåŠ¨è§¦å‘' }}"
    
    # - name: åˆ›å»ºåŒæ­¥æˆåŠŸæŠ¥å‘Š
    #   if: steps.merge_upstream.outputs.merge_success == 'true'
    #   uses: actions/github-script@v7
    #   with:
    #     script: |
    #       const newCommits = '${{ needs.check-upstream.outputs.new_commits }}';
    #       const priority = '${{ needs.check-upstream.outputs.priority }}';
          
    #       await github.rest.issues.create({
    #         owner: context.repo.owner,
    #         repo: context.repo.repo,
    #         title: 'âœ… è‡ªåŠ¨åŒæ­¥å®Œæˆ',
    #         body: `
    #         ## ğŸ‰ è‡ªåŠ¨åŒæ­¥æˆåŠŸ
            
    #         **åŒæ­¥æ—¶é—´**: ${new Date().toISOString()}
    #         **åŒæ­¥æäº¤**: ${newCommits} ä¸ªæ–°æäº¤
    #         **æ›´æ–°ä¼˜å…ˆçº§**: ${priority.toUpperCase()}
    #         **è§¦å‘æ–¹å¼**: ${context.eventName === 'workflow_dispatch' ? 'æ‰‹åŠ¨è§¦å‘' : 'è‡ªåŠ¨è§¦å‘'}
            
    #         ## ğŸ“‹ åŒæ­¥è¯¦æƒ…
            
    #         å·²æˆåŠŸå°†ä¸Šæ¸¸ä»“åº“çš„æ›´æ–°åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚
            
    #         ## ğŸ” åç»­æ£€æŸ¥å»ºè®®
            
    #         1. éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸
    #         2. è¿è¡Œæµ‹è¯•å¥—ä»¶
    #         3. æ£€æŸ¥ç›¸å…³æ–‡æ¡£
            
    #         ---
            
    #         *æ­¤æŠ¥å‘Šç”±GitHub Actionsè‡ªåŠ¨ç”Ÿæˆ*
    #         `,
    #         labels: ['upstream-sync', 'auto-sync', 'success']
    #       });

    - name: è¾“å‡ºåˆå¹¶å†²çªæŠ¥å‘Š
      if: steps.merge_upstream.outputs.merge_success == 'false'
      run: |
        echo "âŒ è‡ªåŠ¨åŒæ­¥å¤±è´¥ - å­˜åœ¨å†²çª"
        echo "å¤±è´¥æ—¶é—´: $(date)"
        echo "å¾…åŒæ­¥æäº¤: ${{ needs.check-upstream.outputs.new_commits }} ä¸ª"
        echo "å¤±è´¥åŸå› : æ£€æµ‹åˆ°æ–‡ä»¶å†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³"
        echo ""
        echo "è§£å†³æ­¥éª¤:"
        echo "1. æ‰‹åŠ¨è¿è¡Œ: git merge upstream/${{ env.SYNC_BRANCH }}"
        echo "2. è§£å†³æ‰€æœ‰å†²çªæ–‡ä»¶"
        echo "3. æäº¤æ›´æ”¹: git commit -m \"è§£å†³åˆå¹¶å†²çª\""
        echo "4. æ¨é€æ›´æ–°: git push origin ${{ env.SYNC_BRANCH }}"

    # - name: å¤„ç†åˆå¹¶å†²çª
    #   if: steps.merge_upstream.outputs.merge_success == 'false'
    #   uses: actions/github-script@v7
    #   with:
    #     script: |
    #       const newCommits = '${{ needs.check-upstream.outputs.new_commits }}';
          
    #       await github.rest.issues.create({
    #         owner: context.repo.owner,
    #         repo: context.repo.repo,
    #         title: 'âŒ è‡ªåŠ¨åŒæ­¥å¤±è´¥ - å­˜åœ¨å†²çª',
    #         body: `
    #         ## âš ï¸ è‡ªåŠ¨åŒæ­¥å¤±è´¥
            
    #         **å¤±è´¥æ—¶é—´**: ${new Date().toISOString()}
    #         **å¾…åŒæ­¥æäº¤**: ${newCommits} ä¸ª
    #         **å¤±è´¥åŸå› **: æ£€æµ‹åˆ°æ–‡ä»¶å†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³
            
    #         ## ğŸ› ï¸ è§£å†³æ­¥éª¤
            
    #         1. æ‰‹åŠ¨è¿è¡Œ: \`git merge upstream/${{ env.SYNC_BRANCH }}\`
    #         2. è§£å†³æ‰€æœ‰å†²çªæ–‡ä»¶
    #         3. æäº¤æ›´æ”¹: \`git commit -m "è§£å†³åˆå¹¶å†²çª"\`
    #         4. æ¨é€æ›´æ–°: \`git push origin ${{ env.SYNC_BRANCH }}\`
            
    #         ## ğŸ“ ç›¸å…³å‘½ä»¤
            
    #         \`\`\`bash
    #         # æŸ¥çœ‹å†²çªçŠ¶æ€
    #         git status
            
    #         # ä¸­æ­¢åˆå¹¶ï¼ˆå¦‚æœéœ€è¦é‡æ–°å¼€å§‹ï¼‰
    #         git merge --abort
            
    #         # æ‰‹åŠ¨åˆå¹¶
    #         git merge upstream/${{ env.SYNC_BRANCH }}
    #         \`\`\`
            
    #         ---
            
    #         *æ­¤æŠ¥å‘Šç”±GitHub Actionsè‡ªåŠ¨ç”Ÿæˆ*
    #         `,
    #         labels: ['upstream-sync', 'conflict', 'needs-attention']
    #       });

  # æ–°å¢ï¼šå†²çªæ‰‹åŠ¨å¤„ç†å·¥ä½œæµ
  manual-conflict-resolution:
    runs-on: ubuntu-latest
    name: å†²çªå¤„ç†ï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰
    needs: check-upstream
    if: |
      github.event_name == 'workflow_dispatch' &&
      needs.check-upstream.outputs.has_updates == 'true' &&
      needs.check-upstream.outputs.has_conflicts == 'true'
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: é…ç½®Git
      run: |
        git config --global user.name 'GitHub Actions Bot'
        git config --global user.email 'actions@github.com'
    
    - name: åˆ›å»ºåŒæ­¥åˆ†æ”¯
      id: create_branch
      run: |
        git remote add upstream https://github.com/hsliuping/TradingAgents-CN.git
        git fetch upstream
        SYNC_BRANCH_NAME="sync/upstream-$(date +%Y%m%d-%H%M%S)"
        git checkout -b $SYNC_BRANCH_NAME
        echo "sync_branch_name=$SYNC_BRANCH_NAME" >> $GITHUB_OUTPUT
        
        # å°è¯•åˆå¹¶ï¼Œé¢„æœŸä¼šæœ‰å†²çª
        echo "å°è¯•åˆå¹¶ä¸Šæ¸¸æ›´æ–°ï¼ˆé¢„æœŸä¼šæœ‰å†²çªï¼‰..."
        git merge upstream/${{ env.SYNC_BRANCH }} || echo "åˆå¹¶å­˜åœ¨å†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³"
    
    - name: æ˜¾ç¤ºå†²çªçŠ¶æ€
      run: |
        echo "å½“å‰åˆ†æ”¯: $(git branch --show-current)"
        echo "å†²çªçŠ¶æ€:"
        git status
    
    # - name: åˆ›å»ºPRå‡†å¤‡
    #   uses: actions/github-script@v7
    #   with:
    #     script: |
    #       const branchName = '${{ steps.create_branch.outputs.sync_branch_name }}';
          
    #       await github.rest.issues.create({
    #         owner: context.repo.owner,
    #         repo: context.repo.repo,
    #         title: `ğŸ”§ éœ€è¦æ‰‹åŠ¨è§£å†³å†²çª - åˆ†æ”¯ ${branchName}`,
    #         body: `
    #         ## ğŸ› ï¸ å†²çªè§£å†³ä»»åŠ¡
            
    #         å·²åˆ›å»ºåˆ†æ”¯ **${branchName}** ç”¨äºå¤„ç†ä¸Šæ¸¸åŒæ­¥å†²çªã€‚
            
    #         ## ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ
            
    #         1. åœ¨æœ¬åœ°æ‹‰å–åˆ†æ”¯: \`git fetch origin && git checkout ${branchName}\`
    #         2. è§£å†³æ‰€æœ‰å†²çªæ–‡ä»¶
    #         3. æäº¤æ›´æ”¹: \`git add . && git commit -m "è§£å†³ä¸Šæ¸¸åŒæ­¥å†²çª"\`
    #         4. æ¨é€å¹¶åˆ›å»ºPR: \`git push origin ${branchName}\`
            
    #         ## ğŸ” å†²çªæ–‡ä»¶
            
    #         è¯·åœ¨æœ¬åœ°æŸ¥çœ‹å…·ä½“å†²çªæ–‡ä»¶å¹¶è¿›è¡Œè§£å†³ã€‚
            
    #         ---
            
    #         *æ­¤ä»»åŠ¡ç”±GitHub Actionsè‡ªåŠ¨åˆ›å»º*
    #         `,
    #         labels: ['upstream-sync', 'conflict', 'manual-resolution']
    #       });

    - name: æ¨é€åŒæ­¥åˆ†æ”¯
      run: |
        git push origin ${{ steps.create_branch.outputs.sync_branch_name }}
        echo "âœ… å·²æ¨é€åŒæ­¥åˆ†æ”¯: ${{ steps.create_branch.outputs.sync_branch_name }}"
    
    - name: è¾“å‡ºæ‰‹åŠ¨è§£å†³æŒ‡å—
      run: |
        echo "ğŸ”§ éœ€è¦æ‰‹åŠ¨è§£å†³å†²çª"
        echo "å·²åˆ›å»ºåˆ†æ”¯ ${{ steps.create_branch.outputs.sync_branch_name }} ç”¨äºå¤„ç†ä¸Šæ¸¸åŒæ­¥å†²çªã€‚"
        echo ""
        echo "ä¸‹ä¸€æ­¥æ“ä½œ:"
        echo "1. åœ¨æœ¬åœ°æ‹‰å–åˆ†æ”¯: git fetch origin && git checkout ${{ steps.create_branch.outputs.sync_branch_name }}"
        echo "2. è§£å†³æ‰€æœ‰å†²çªæ–‡ä»¶"
        echo "3. æäº¤æ›´æ”¹: git add . && git commit -m \"è§£å†³ä¸Šæ¸¸åŒæ­¥å†²çª\""
        echo "4. æ¨é€å¹¶åˆ›å»ºPR: git push origin ${{ steps.create_branch.outputs.sync_branch_name }}"

    - name: è§¦å‘ Docker æ„å»º
      if: success()
      uses: benc-uk/workflow-dispatch@v1
      with:
        workflow: è‡ªåŠ¨æ„å»ºDockerå¹¶æäº¤  # æ‚¨æ„å»ºå·¥ä½œæµçš„åç§°
        token: ${{ secrets.GITHUB_TOKEN }}  # å¯ä½¿ç”¨ PAT_TOKEN
        ref: ${{ github.ref }}
